<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="xywx.mapping.CustomerDao">
	<resultMap id="BaseResultMap" type="xywx.dao.Customer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Apr 26 
			21:15:45 CST 2016. -->
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="origin" property="origin" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="openid" property="openid" jdbcType="VARCHAR" />
		<result column="gender" property="gender" jdbcType="INTEGER" />
		<result column="age" property="age" jdbcType="INTEGER" />
		<result column="career" property="career" jdbcType="VARCHAR" />
		<result column="place" property="place" jdbcType="VARCHAR" />
		<result column="testcount" property="testcount" jdbcType="VARCHAR" />
		<result column="createtime" property="createtime" jdbcType="DATE" />
	</resultMap>

	<select id="selectCustomers" resultMap="BaseResultMap">
		SELECT c1.*,CASE WHEN t.testcount is not NULL THEN t.testcount ELSE 0
		END as testcount
		from customer c1 LEFT JOIN( SELECT c.id,COUNT(t.id) as
		testcount FROM
		`customer` c LEFT JOIN test t on c.id = t.customerid) t
		on c1.id =
		t.id where 1=1
		<if test="gender != null and gender != ''">
			and c1.gender = #{gender}
		</if>
		<if test="age != null and age != ''">
			and c1.age = #{age}
		</if>
		<if test="career != null and career != ''">
			and c1.career = #{career}
		</if>
		<if test="place != null and place != ''">
			and c1.place = #{place}
		</if>
		<if test="name != null and name != ''">
			and c1.name like '%${name}%'
		</if>
		order by c1.createtime desc
	</select>

	<select id="selChooseCustomer" resultMap="BaseResultMap">
		select * from customer where id = #{id}
	</select>
</mapper>